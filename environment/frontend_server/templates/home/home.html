{% extends "base.html" %}
{% load staticfiles %}

{% block content %}
<style>
	#persona-sidebar {
		position: fixed;
		right: 10px;
		top: 80px;
		width: 280px;
		max-height: 80vh;
		overflow-y: auto;
		background: rgba(255,255,255,0.95);
		border: 1px solid #ccc;
		border-radius: 8px;
		padding: 8px;
		font-size: 12px;
		z-index: 1000;
		box-shadow: 0 2px 8px rgba(0,0,0,0.15);
	}
	#persona-sidebar h4 {
		margin: 0 0 8px 0;
		padding-bottom: 5px;
		border-bottom: 1px solid #ddd;
		font-size: 14px;
	}
	.persona-row {
		display: flex;
		align-items: center;
		padding: 4px 6px;
		margin: 2px 0;
		border-radius: 4px;
		cursor: pointer;
		transition: background 0.2s;
	}
	.persona-row:hover {
		background: #e8f4fc;
	}
	.persona-initials {
		display: inline-block;
		width: 28px;
		height: 28px;
		line-height: 28px;
		text-align: center;
		background: #4a90d9;
		color: white;
		border-radius: 50%;
		font-weight: bold;
		font-size: 11px;
		margin-right: 8px;
		flex-shrink: 0;
	}
	.persona-action {
		flex: 1;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
		color: #333;
	}
</style>

<div id="persona-sidebar">
	<h4>Characters</h4>
	{% for p_name, p_name_os in persona_names %}
	<div class="persona-row" title="{{ p_name }}" onclick="goToPersona('{{ p_name }}')" data-persona="{{ p_name_os }}">
		<span class="persona-initials" id="sidebar_initials__{{ p_name_os }}">--</span>
		<span class="persona-action" id="sidebar_action__{{ p_name_os }}">...</span>
	</div>
	{% endfor %}
	<script>
		// Set initials for each persona
		{% for p_name, p_name_os in persona_names %}
		(function() {
			let name = "{{ p_name }}";
			let rgx = new RegExp(/(\p{L}{1})\p{L}+/, 'gu');
			let initials = [...name.matchAll(rgx)] || [];
			initials = ((initials.shift()?.[1] || '') + (initials.pop()?.[1] || '')).toUpperCase();
			document.getElementById("sidebar_initials__{{ p_name_os }}").innerText = initials;
		})();
		{% endfor %}
	</script>
</div>

<br>
<br>
<div>
	<div id="game-container" style="text-align: center"></div>

	<div style="width:55%; margin: 0 auto; margin-top:4.5em">
		<h3 style="margin-bottom:-0.5em; font-size:1.5em">Current Time:</h3>
		<div class="row">
			<div class="col-md-8" id="game-time" style="">
				<h2><span id="game-time-content"></span></h2> 
			</div>
			<div class="col-md-4">
				
				<h2 style="text-align: right; {% if mode == 'simulate' %} display: none {% endif %}">
					<button id="play_button" type="button" class="btn btn-default">
				    <strong style=" font-size:1.2em"><i class="glyphicon glyphicon-play"></i> &nbsp;Play</strong>
				  </button>
				  
				  <button id="pause_button" type="button" class="btn btn-default">
				    <strong style=" font-size:1.2em"><i class="glyphicon glyphicon-pause"></i> &nbsp;Pause</strong>
				  </button>

				</h2>
				
			</div>
		</div>

		<br>
		<hr style="border-color:#999999">
		<br>

		{% for p_name, p_name_os in persona_names %}
			<div class="media" style="background-color:#EEEEEE; padding:1em; padding-left:3.5em; padding-right:2em; border-radius:10px">
			  <div class="media-left media-middle">
			    <a href="#">
			      {% with 'assets/characters/profile/'|add:p_name_os|add:'.png' as profile_image %}
			      <img class="media-object" src="{% static profile_image %}" style="width:5em">
			      {% endwith %}
			    </a>
			  </div>
			  <div class="media-body" style='padding-left:3em; padding-top:0.5em; padding-bottom:1em'>
			  	<div class="row">
			    	<h2 class="col-md-8" id="name__{{ p_name_os }}" style="margin-bottom:0.8em; font-size:1.85em; ">
			    		{{p_name}} &nbsp;&nbsp;
			    		<a href="{% url 'replay_persona_state' sim_code step p_name_os %}" style="font-size:0.6em">State Details</a>
			    	</h2>
			    </div>
			    <div style="">
					  <p style="font-size:1.2em"><strong>Current Action:</strong> <br><span id="current_action__{{ p_name_os }}"></span></p>
					  <p style="font-size:1.2em"><strong>Location:</strong> <br><span id="target_address__{{ p_name_os }}"></span></p>
					  <p style="font-size:1.2em"><strong>Current Conversation:</strong> <br><span id="chat__{{ p_name_os }}"></span></p>
					</div>
			  </div>
			</div>	
			<br>
		{% endfor %}




		

	</div>
</div>

  



<div style="padding-bottom:15em"> </div>


<!-- partial -->
<script src='https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js'></script>
{% include 'home/main_script.html' %}
{% endblock content %}

